---
- name: common configuration
  become: yes
  hosts: all
  roles:
    - create-sudo-user
    - install-modules
    - configure-hosts-file

- name: setup admin node
  become: yes
  become_user: cephuser
  hosts: admin
  roles:
    - configure-admin

- name: copy admin key to nodes
  become: yes
  become_user: cephuser
  hosts: mon, osd
  roles:
    - copy-keys

- name: ceph-deploy setup
  become: yes
  hosts: admin
  roles:
    - ceph-deploy-setup

- name: deploy cluster
  become: yes
  # become_method: su
  become_user: cephuser
  # become_flags: '-'
  hosts: admin
  roles:
    - deploy-ceph-cluster

- name: install REX-Ray
  become: yes
  hosts: osd
  roles:
    - rex-ray-installation
    - rex-ray-configuration

- name: install Docker
  become: yes
  hosts: osd
  roles:
    - docker-installation

- name: init Docker swarm
  hosts: node-1
  roles:
    - docker-swarm-init

- name: add managers
  hosts: node-2, node-3
  roles:
    - docker-swarm-add-manager
